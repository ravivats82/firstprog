---
- name: Test code to display variables
  hosts: "{{ groups[hg_all][1] }}"
  gather_facts: no
  become: false

  tasks:
    - block:
      - name: trimming first 3 characters
        set_fact:
          searchname: "RS_{{ cluster[-3:]|upper }}_{{ sharetype|replace(' ','') }}*"
      - name: display variable
        debug:
          msg: "{{ searchname }}"
      - name: current share number increment by 1
        set_fact:
          currentshareno: "{{ cluster[-3:] | int + 1 }}"
      - name: convert to 3 digit
        set_fact:
          shareno: "{{ \"%03d\" | format(currentshareno | int) }}"
      - name: display variable
        debug:
          msg: "{{ shareno }}"
      - name: ping cluster
        command: 
          ls -ltr /
        register: new_var
      - name: trim new_var
        shell:
          echo "{{ new_var }}" | tail -1 | awk /./ | awk '{print $2}'
        register: fetchedshare
      - name: display variable
        debug:
          msg: "{{ fetchedshare }}"
        ignore_errors: true
      - name: fail the task if server is not pinging
        fail:
          msg: "please check google.com"
        when: (new_var is success) == false
      - name: ping google
        command: 
          /usr/bin/ping -c 1 google.com
        register: new_var1
      - name: display new_var
        debug:
          msg: "google.com is pinging"
        when: (new_var1 is success) == True
      rescue:
        - name: display message
          debug:
            msg: "this is rescue block for anyserver"
